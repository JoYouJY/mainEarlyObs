import{initializeApp}from'https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js';import{getAuth,signInWithPopup,signOut,GoogleAuthProvider,OAuthProvider}from'https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js';import{getFirestore,collection,serverTimestamp,addDoc,setDoc,getDoc,doc}from'https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js';var providerNEW,signerNEW,userAccountNEW,AAornot;const MasterChainID=0x92,call_type={'CONNECT':0x1,'SEND_CONTRACT':0x2,'FULL_SCREEN':0x3,'NEW_ACCOUNT':0x4,'CONNECT_AA':0x5,'GET_BALANCE':0x6,'INSTALL_PROMPT':0x7,'GOOGLE_SIGNIN':0x8,'GOOGLE_SAVE_INFO':0x9,'GOOGLE_SIGNOUT':0xa,'CONNECT_PERSONAL_WALLET':0xb,'TOGGLE_SEND_CONTRACT_AA':0xc,'REFRESH_PAGE':0xd,'ON_UNITY_LOADED':0xe},response_type={'ERROR':0x1,'HASH':0x2,'RECEIPT':0x3,'ACCOUNT_NUMBER':0x4,'READ_RESPONSE':0x5,'ROTATE':0x6,'UPDATE':0x7,'WALLET':0x8,'KEY':0x9,'RECOVERY':0xa,'BALANCE':0xb,'AA_CONNECTED':0xc,'GOOGLE_SIGNUP':0xd,'GOOGLE_DONE_SAVE_INFO':0xe,'GOOGLE_SIGNIN':0xf,'GOOGLE_CANCEL':0x10,'GOOGLE_SIGNOUT_DONE':0x11,'GOOGLE_IS_SIGNIN':0x12,'PERSONAL_WALLET_ADDRESS':0x13,'GET_SEND_CONTRACT_AA':0x14};var GLOBALWALLETADDRESS;async function ConnectWallet(){!window['ethereum']&&alert('A\x20personal\x20wallet\x20like\x20MetaMask\x20or\x20Rabby\x20is\x20required\x20to\x20continue.\x20Please\x20install\x20one\x20to\x20proceed.');let a=window['ethereum'];if(window['ethereum']['providers']&&window['ethereum']['providers']['length']){const d=window['ethereum']['providers']['find'](e=>e['isRabby']);d&&(a=d);}console['log']('--connect--'),console['log'](a),console['log']('--end--'),providerNEW=new ethers['BrowserProvider'](a);const b=await providerNEW['getNetwork']();let c=parseInt(b['chainId'],0xa);if(c!==MasterChainID){switchToFantom(),alert('Switch\x20to\x20Sonic\x20Network\x20before\x20Connecting.');return;}signerNEW=await providerNEW['getSigner']();try{await a['request']({'method':'eth_requestAccounts'});}catch(e){if(e['code']===0xfa1){window['location']['href']='ethereum:';return;}}userAccountNEW=await signerNEW['getAddress'](),AAornot=![],GLOBALWALLETADDRESS=userAccountNEW,sendBalanceinfo(),response(response_type['ACCOUNT_NUMBER'],userAccountNEW);}async function ConnectPersonalWallet(){!window['ethereum']&&alert('A\x20personal\x20wallet\x20like\x20MetaMask\x20or\x20Rabby\x20is\x20required\x20to\x20continue.\x20Please\x20install\x20one\x20to\x20proceed.');let a=window['ethereum'];if(window['ethereum']['providers']&&window['ethereum']['providers']['length']){const d=window['ethereum']['providers']['find'](e=>e['isRabby']);d&&(a=d);}console['log']('--connect--'),console['log'](a),console['log']('--end--'),providerNEW=new ethers['BrowserProvider'](a);const b=await providerNEW['getNetwork']();let c=parseInt(b['chainId'],0xa);if(c!==MasterChainID){switchToFantom(),alert('Switch\x20to\x20Sonic\x20Network\x20before\x20Connecting.');return;}signerNEW=await providerNEW['getSigner']();try{await a['request']({'method':'eth_requestAccounts'});}catch(e){if(e['code']===0xfa1){window['location']['href']='ethereum:';return;}}userAccountNEW=await signerNEW['getAddress'](),AAornot=![],GLOBALWALLETADDRESS=userAccountNEW,sendBalanceinfo(),response(response_type['PERSONAL_WALLET_ADDRESS'],userAccountNEW);}async function ToggleAAornot(){AAornot=!AAornot,response(response_type['GET_SEND_CONTRACT_AA'],AAornot);}async function RefreshF5(){window['location']['reload']();}function CreateWeb2Wallet(){const a=ethers['Wallet']['createRandom']();AA_privateKey=a['privateKey'],AA_recipient=a['address'];}const AA_rpcUrl='https://rpc.soniclabs.com',AA_chainId=0x92,AA_provider=new ethers['JsonRpcProvider'](AA_rpcUrl,{'name':'Sonic','chainId':AA_chainId});var AA_wallet;async function getSBalance(a){const b=await AA_provider['getBalance'](a),c=ethers['formatEther'](b);response(response_type['BALANCE'],c);}async function sendBalanceinfo(){try{if(!GLOBALWALLETADDRESS)return;const a=await AA_provider['getBalance'](GLOBALWALLETADDRESS),b=ethers['formatEther'](a);response(response_type['BALANCE'],b);}catch(c){console['error']('Error\x20fetching\x20balance:\x20',c);}}setInterval(sendBalanceinfo,0x1fc2);async function CreateAndConnectWeb2Wallet(a,b){const c=ethers['Wallet']['createRandom']();var d=c['privateKey'],e=c['address'];AA_wallet=new ethers['Wallet'](d,AA_provider);const f=new ethers['Wallet'](a,AA_provider),g='0xEB5bCD3f18f33935b93C3F0Ac9b9d359482568cc',h=[{'inputs':[{'internalType':'address','name':'recipient','type':'address'},{'internalType':'uint256','name':'passcode','type':'uint256'}],'name':'distributeFaucet','outputs':[],'stateMutability':'nonpayable','type':'function'}],i=new ethers['Contract'](g,h,f);try{const l=await i['distributeFaucet'](e,b,{'gasLimit':0x1d4c0}),m=await l['wait']();}catch(n){console['error']('Error\x20distributing\x20faucet:',n['message']);}const j=await AA_provider['getNetwork']();var k=j['chainId'];k=parseInt(k,0xa);if(k!==MasterChainID){switchToFantom(),alert('Switch\x20to\x20Sonic\x20Network\x20before\x20Connecting.');return;}AAornot=!![],GLOBALWALLETADDRESS=e,sendBalanceinfo(),response(response_type['WALLET'],e),response(response_type['KEY'],d),response(response_type['RECOVERY'],c['mnemonic']['phrase']),AAornot=!![];}async function ConnectAAWallet(a,b){var c=b,d=a;AA_wallet=new ethers['Wallet'](c,AA_provider);const e=await AA_provider['getNetwork']();var f=e['chainId'];f=parseInt(f,0xa);if(f!==MasterChainID){switchToFantom(),alert('Switch\x20to\x20Sonic\x20Network\x20before\x20Connecting.');return;}AAornot=!![],GLOBALWALLETADDRESS=d,sendBalanceinfo(),response(response_type['AA_CONNECTED'],d),AAornot=!![];}var isfullscreen=![];function EnterFullScreen(){isfullscreen?(window['unityInstance']['SetFullscreen'](0x0),isfullscreen=![]):(window['unityInstance']['SetFullscreen'](0x1),isfullscreen=!![]);}function JsCallFunction(a,b){console['log']('JsCallFunction\x20type='+a);if(a==call_type['CONNECT'])ConnectWallet();else{if(a==call_type['FULL_SCREEN'])window['parent']['postMessage']('toggleFullscreen','*');else{if(a==call_type['SEND_CONTRACT']){b=b['toString']();if(b['startsWith']('<sendContract>')&&b['endsWith']('</sendContract>')){const o=b['substring']('<sendContract>'['length'])['slice'](0x0,b['length']-('<sendContract>'['length']+'</sendContract>'['length'])),p=o['split']('_%_');if(p['length']==0x8){var c=p[0x0],d=p[0x1],e=p[0x2],f=p[0x3],g=p[0x4],h=p[0x5],i=p[0x6],j=p[0x7];sendContract(c,e,j,d,f,g,h,i);}}}else{if(a==call_type['NEW_ACCOUNT']){if(b['startsWith']('<sendContract>')&&b['endsWith']('</sendContract>')){const q=b['substring']('<sendContract>'['length'])['slice'](0x0,b['length']-('<sendContract>'['length']+'</sendContract>'['length'])),r=q['split']('_%_');if(r['length']==0x2){var k=r[0x0],l=r[0x1];CreateAndConnectWeb2Wallet(k,l);}}}else{if(a==call_type['CONNECT_AA']){if(b['startsWith']('<sendContract>')&&b['endsWith']('</sendContract>')){const s=b['substring']('<sendContract>'['length'])['slice'](0x0,b['length']-('<sendContract>'['length']+'</sendContract>'['length'])),t=s['split']('_%_');if(t['length']==0x2){var m=t[0x0],n=t[0x1];ConnectAAWallet(m,n);}}}else{if(a==call_type['GET_BALANCE']){if(b['startsWith']('<sendContract>')&&b['endsWith']('</sendContract>')){const u=b['substring']('<sendContract>'['length'])['slice'](0x0,b['length']-('<sendContract>'['length']+'</sendContract>'['length']));getSBalance(u);}}else{if(a==call_type['INSTALL_PROMPT'])hideCanvasAndShowPrompt();else{if(a==call_type['GOOGLE_SIGNIN'])SignInGoogle();else{if(a==call_type['GOOGLE_SAVE_INFO']){console['log']('type\x20==\x20call_type.GOOGLE_SAVE_INFO');const v=b['split']('_%_');GoogleSaveInfo(v);}else{if(a==call_type['GOOGLE_SIGNOUT'])SignOutGoogle();else{if(a==call_type['CONNECT_PERSONAL_WALLET'])ConnectPersonalWallet();else{if(a==call_type['TOGGLE_SEND_CONTRACT_AA'])ToggleAAornot();else{if(a==call_type['REFRESH_PAGE'])RefreshF5();else a==call_type['ON_UNITY_LOADED']&&OnUnityLoaded();}}}}}}}}}}}}}window['JsCallFunction']=JsCallFunction;async function JsGetFunction(a,b){b=b['toString']();if(b['startsWith']('<readContract>')&&b['endsWith']('</readContract>')){const i=b['substring']('<readContract>'['length'])['slice'](0x0,b['length']-('<readContract>'['length']+'</sendContract>'['length'])),j=i['split']('_%_');if(j['length']==0x5){var c=j[0x0],d=j[0x1],e=j[0x2],f=j[0x3],g=j[0x4],h=await readContract(c,e,g,d,f);return response(response_type['READ_RESPONSE'],c['toString']()+'_%_'+JSON['stringify'](h)),JSON['stringify'](h);}}}window['JsGetFunction']=JsGetFunction;async function readContract(a,b,c,d,e){return new Promise(async(f,g)=>{try{const h=new ethers['Contract'](d,c,providerNEW),i=await h[b](...JSON['parse'](e)),j=unwrapProxy(i),k=convertBigIntsToStrings(j);f(k);}catch(l){console['error'](l),g(l);}});}async function sendContract(a,b,c,d,e,f,g,h){if(AAornot==![]){providerNEW=new ethers['BrowserProvider'](window['ethereum']);const k=await providerNEW['getNetwork']();var i=k['chainId'];i=parseInt(i,0xa);if(i!==MasterChainID)switchToFantom(),response(response_type['ERROR'],b+'_%%_'+'wrong\x20RPC,\x20switch\x20to\x20Sonic\x20Network\x20and\x20Retry.');else{const l=new ethers['Contract'](d,c,providerNEW),m=l['connect'](signerNEW);var j={};g!=''&&(j['gasLimit']=g);h!=''&&(j['gasPrice']=h);f!=''&&(j['value']=f);try{const n=await m[b](...JSON['parse'](e),j),o=new Date();response(response_type['HASH'],b);const p=await getTransactionReceiptWithRetry(n['hash'],0x78),q=new Date(),r=q-o,s=[];for(const w of p['logs']){const x=l['interface']['parseLog'](w);x?s['push'](x):s['push'](w);}const t=unwrapProxy(s),u=convertBigIntsToStrings(t),v=JSON['stringify'](u);return response(response_type['RECEIPT'],b+'_%%_'+JSON['stringify'](u)),sendBalanceinfo(),p;}catch(y){console['error']('Error\x20sending\x20transaction:',y),response(response_type['ERROR'],b+'_%%_'+y['message']),sendBalanceinfo();}}sendBalanceinfo();}else{providerNEW=AA_provider;const z=await providerNEW['getNetwork']();var i=z['chainId'];i=parseInt(i,0xa);if(i!==MasterChainID)switchToFantom(),response(response_type['ERROR'],b+'_%%_'+'wrong\x20RPC,\x20switch\x20to\x20Sonic\x20Network\x20and\x20Retry.');else{const A=new ethers['Contract'](d,c,providerNEW),B=A['connect'](AA_wallet);var j={};g!=''&&(j['gasLimit']=g);h!=''&&(j['gasPrice']=h);f!=''&&(j['value']=f);try{const C=await B[b](...JSON['parse'](e),j),D=new Date();response(response_type['HASH'],b);const E=await getTransactionReceiptWithRetry(C['hash'],0x78),F=new Date(),G=F-D,H=[];for(const L of E['logs']){const M=A['interface']['parseLog'](L);M?H['push'](M):H['push'](L);}const I=unwrapProxy(H),J=convertBigIntsToStrings(I),K=JSON['stringify'](J);return response(response_type['RECEIPT'],b+'_%%_'+JSON['stringify'](J)),sendBalanceinfo(),E;}catch(N){console['error']('Error\x20sending\x20transaction:',N),response(response_type['ERROR'],b+'_%%_'+N['message']),sendBalanceinfo();}sendBalanceinfo();}}}async function sendContractAA(a,b,c,d,e,f,g,h){providerNEW=AA_provider;const i=await providerNEW['getNetwork']();var j=i['chainId'];j=parseInt(j,0xa);if(j!==MasterChainID)switchToFantom(),response(response_type['ERROR'],b+'_%%_'+'wrong\x20RPC,\x20switch\x20to\x20Sonic\x20Network\x20and\x20Retry.');else{const l=new ethers['Contract'](d,c,providerNEW),m=l['connect'](AA_wallet);var k={};g!=''&&(k['gasLimit']=g);h!=''&&(k['gasPrice']=h);f!=''&&(k['value']=f);try{const n=await m[b](...JSON['parse'](e),k),o=new Date();response(response_type['HASH'],b);const p=await getTransactionReceiptWithRetry(n['hash'],0x78),q=new Date(),r=q-o,s=[];for(const w of p['logs']){const x=l['interface']['parseLog'](w);x?s['push'](x):s['push'](w);}const t=unwrapProxy(s),u=convertBigIntsToStrings(t),v=JSON['stringify'](u);return response(response_type['RECEIPT'],b+'_%%_'+JSON['stringify'](u)),p;}catch(y){console['error']('Error\x20sending\x20transaction:',y),response(response_type['ERROR'],b+'_%%_'+y['message']);}}}function delay(a){return new Promise(b=>setTimeout(b,a));}async function getTransactionReceiptWithRetry(a,b){let c=0x0,d=null;await delay(0x320);while(c<b){await delay(0x1c2),d=await providerNEW['getTransactionReceipt'](a);if(d)return d;c++;}return null;}function unwrapProxy(a){if(typeof a!=='object'||a===null)return a;if(Array['isArray'](a))return a['map'](unwrapProxy);if(a['stateMutability']==='private'){const c=abi['decode'](a['signature'],a['args']);return c;}const b={};for(let d in a){b[d]=unwrapProxy(a[d]);}return b;}function convertBigIntsToStrings(a){if(typeof a==='bigint')return a['toString']();else{if(Array['isArray'](a))return a['map'](b=>convertBigIntsToStrings(b));else{if(typeof a==='object'&&a!==null){const b={};for(const c in a){a['hasOwnProperty'](c)&&(b[c]=convertBigIntsToStrings(a[c]));}return b;}else return a;}}}async function response(a,b){var c='<response>'+a+'_%_'+b+'</response>';window['unityInstance']['SendMessage']('JavascriptBridgeManager','ResponseToUnity',c);}window['getAggressiveGasPrice']=async function(){try{const a=await providerNEW['getFeeData'](),b=a['gasPrice']*BigInt(0xf)/BigInt(0xa);return b;}catch(c){console['error']('Error:',c);throw c;}};async function switchToFantom(){const a='0x'+MasterChainID['toString'](0x10);try{await window['ethereum']['request']({'method':'wallet_switchEthereumChain','params':[{'chainId':a}]});}catch(b){if(b['code']===0x1326)console['error']('User\x20rejected\x20the\x20network\x20switch\x20request.');else b['code']===0x1325?console['error']('Fantom\x20Chain\x20not\x20found\x20in\x20your\x20wallet.'):console['error']('Error\x20switching\x20to\x20Fantom\x20Chain:',b);}}var isHorizontal=!![];function rotateCanvas(){isHorizontal=!isHorizontal;var a=document['getElementById']('unity-canvas'),b=a['style']['width'];a['style']['width']=a['style']['height'],a['style']['height']=b,response(response_type['ROTATE'],isHorizontal);}function hideCanvasAndShowPrompt(){canvas['style']['display']='block';const a=document['createElement']('div');a['style']['position']='fixed',a['style']['top']='50%',a['style']['left']='50%',a['style']['transform']='translate(-50%,\x20-50%)',a['style']['padding']='20px',a['style']['backgroundColor']='#fff',a['style']['boxShadow']='0\x200\x2010px\x20rgba(0,0,0,0.5)',a['style']['zIndex']='1000';const b=document['createElement']('p');b['innerText']='Do\x20you\x20want\x20to\x20install\x20the\x20Fate\x20Adventure\x20WebAPP?',a['appendChild'](b);const c=document['createElement']('button');c['innerText']='Yes',c['onclick']=()=>{showInstallPrompt(),document['body']['removeChild'](a);},a['appendChild'](c);const d=document['createElement']('button');d['innerText']='No',d['onclick']=()=>{document['body']['removeChild'](a),canvas['style']['display']='block';},a['appendChild'](d),document['body']['appendChild'](a);}const firebaseConfig={'apiKey':'AIzaSyAs3pIEa8BGUS9Pvn_tJAP-Fyl7VhQ1xzI','authDomain':'fateadventurerpg.firebaseapp.com','projectId':'fateadventurerpg','storageBucket':'fateadventurerpg.firebasestorage.app','messagingSenderId':'615879410047','appId':'1:615879410047:web:a107d100725c7dd6a35a4a','measurementId':'G-SX3RLKSVKD'},app=initializeApp(firebaseConfig),auth=getAuth(app),db=getFirestore(app),google_provider=new GoogleAuthProvider();async function SignInGoogle(){console['log']('[____]\x20SignInGoogle()');if(auth['currentUser'])console['log']('[____]\x20Had\x20ald\x20Login():',auth['currentUser']['uid']),GetUserInfo(auth['currentUser']);else try{await signInWithPopup(auth,google_provider),console['log']('[____]\x20signInWithPopup()\x20done'),console['log']('[____]\x20user:',auth['currentUser']),console['log']('[____]\x20user.uid:',auth['currentUser']['uid']),auth['currentUser']?GetUserInfo(auth['currentUser']):response(response_type['GOOGLE_CANCEL']);}catch(a){response(response_type['GOOGLE_CANCEL']);}}async function SignOutGoogle(){console['log']('[____]\x20SignOutGoogle()'),signOut(auth),console['log']('[____]\x20Signed\x20Out'),response(response_type['GOOGLE_SIGNOUT_DONE']),console['log']('[____]\x20Signed\x20Out\x20Done');}async function GoogleSaveInfo(a){console['log']('[____]\x20GoogleSaveInfo()\x20splited_text=',a);try{const b=auth['currentUser'],c=await doc(db,'users',b['uid']),d={'version':a[0x0],'randomKey':a[0x1],'encodeAddress1':a[0x2],'encodeAddress2':a[0x3],'encodeKey1':a[0x4],'encodeKey2':a[0x5],'encoded_mnemonic':a[0x6]};await setDoc(c,d),console['log']('[____]\x20Document\x20written'),response(response_type['GOOGLE_DONE_SAVE_INFO']);}catch(e){console['error']('[____]\x20Error\x20adding\x20document:\x20',e);}}async function GetUserInfo(a){console['log']('[____]\x20GetUserInfo()');try{const b=await doc(db,'users',a['uid']),c=await getDoc(b);console['log']('[____]\x20Document\x20Data\x20exists:',c['exists']());if(c['exists']()){console['log']('[____]\x20Logging\x20in\x20Document\x20Data:',c['data']());const d=c['data'](),e=d['version']+'_%%_'+d['randomKey']+'_%%_'+d['encodeAddress1']+'_%%_'+d['encodeAddress2']+'_%%_'+d['encodeKey1']+'_%%_'+d['encodeKey2']+'_%%_'+d['encoded_mnemonic'];console['log']('[____]\x20Login\x20with\x20info:',e),response(response_type['GOOGLE_SIGNIN'],e);}else console['log']('[____]\x20Creating\x20a\x20new\x20account...'),response(response_type['GOOGLE_SIGNUP'],'GetUserInfo');}catch(f){console['error']('[____]\x20Error\x20Reading\x20User\x20Info:\x20',f);}}auth['onAuthStateChanged'](a=>{a&&(response(response_type['GOOGLE_IS_SIGNIN']),console['log']('[____]\x20GOOGLE_IS_SIGNIN'));}),document['body']['style']['backgroundColor']='black';async function OnUnityLoaded(){console['log']('OnUnityLoaded()'),auth['currentUser']&&(response(response_type['GOOGLE_IS_SIGNIN']),console['log']('[OnUnityLoaded]\x20GOOGLE_IS_SIGNIN'));}